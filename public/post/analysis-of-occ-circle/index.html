<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  
  <link rel="prev" href="https://air.googol.im/post/analysis-of-occ-knocker/" />
  <link rel="next" href="https://air.googol.im/post/analysis-of-source-code-printf/" />
  <link rel="canonical" href="https://air.googol.im/post/analysis-of-occ-circle/" />
  <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           一段有趣的C程序（续） | Air on G
       
  </title>
  <meta name="title" content="一段有趣的C程序（续） | Air on G">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="一段有趣的C程序（续）"/>
<meta name="twitter:description" content="同学看完我的一段有趣的程序后，给了我一段bt的程序："/>

  <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "一段有趣的C程序（续）",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/air.googol.im\/post\/analysis-of-occ-circle\/"
  },
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/air.googol.im\/cover.png",
    "width":  800 ,
    "height":  600 
  },
  "genre": "post",
  "keywords": "c, occ",
  "wordcount":  87 ,
  "url": "https:\/\/air.googol.im\/post\/analysis-of-occ-circle\/",
  "datePublished": "2004-09-23T20:00:00\u002b08:00",
  "dateModified": "2004-09-23T20:00:00\u002b08:00",
  "license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.",
  "publisher": {
    "@type": "Organization",
    "name": "Googol Lee",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/air.googol.im\/logo.png",
      "width":  127 ,
      "height":  40 
    }
  },
  "author": {
    "@type": "Person",
    "name": "Googol Lee"
  },
  "description": ""
}
</script>
</head>

  



  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="https://air.googol.im">Air on G</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/post/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
                <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;<a href="https://air.googol.im">Air on G</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/post/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
        </div>
    </div>
</nav>

    	 <main class="main">
          <div class="container">
      		
<article class="post-warp">
    <header class="post-header">
        <h1 class="post-title">一段有趣的C程序（续）</h1>
        <div class="post-meta">
              <a href="https://air.googol.im" rel="author">Googol Lee</a>  ♥ 
                <span class="post-time">
                     <time datetime=2004-09-23 >2004-09-23</time>
                </span>
                
                
                <i class="iconfont icon-timer"></i>
                1 min
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <p>同学看完我的一段有趣的程序后，给了我一段bt的程序：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#define _ -F&lt;00||--F-OO--;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> F<span style="color:#f92672">=</span><span style="color:#ae81ff">00</span>,OO<span style="color:#f92672">=</span><span style="color:#ae81ff">00</span>;main(){F_OO();printf(<span style="color:#e6db74">&#34;%1.3f</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">4.</span><span style="color:#f92672">*-</span>F<span style="color:#f92672">/</span>OO<span style="color:#f92672">/</span>OO);}F_OO()
{
            _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
       _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
    _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
  _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
  _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
    _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
        _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
            _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
}
</code></pre></div><!-- raw HTML omitted -->
<p>俺就又本着人不bt枉少年的精神，又bt的研究了一下。程序贴到vc里，编译出现三个错误，一个是printf未定义，一个是F_00未定义。改动后如下，同时将程序结构改的可读性更强：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#define _ -F&lt;00||--F-OO--;
</span><span style="color:#75715e"></span>F_OO();

<span style="color:#66d9ef">int</span> F<span style="color:#f92672">=</span><span style="color:#ae81ff">00</span>,OO<span style="color:#f92672">=</span><span style="color:#ae81ff">00</span>;

main(){
    F_OO();
    printf(<span style="color:#e6db74">&#34;%1.3f</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">4.</span><span style="color:#f92672">*-</span>F<span style="color:#f92672">/</span>OO<span style="color:#f92672">/</span>OO);
}

F_OO()
{
            _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
       _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
    _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
  _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
 _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
  _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
    _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
        _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
            _<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_<span style="color:#f92672">-</span>_
}
</code></pre></div><p>首先，这个程序bt到用00和OO近似来混淆视听！OO是两个大写字母o，可以作为变量名，而00单独写只是数字0，不能作为变量名。</p>
<p>程序首先定义了一段宏<code>_</code>（md，又是这个下划线），之后定义了两个变量F和OO，并赋予初值0。这里要注意，宏里使用到的就是这两个变量。</p>
<p>之后定义了一个函数F_00()，大量调用了这个宏，来改变变量F和OO的值。虽然程序看起来bt，但实际上归结起来只有两种语句“<code>_</code>”和“<code>-_</code>”两种。这两语句在进行宏替换后分别为“<code>-F&lt;00||--F-OO--;</code>”和“<code>--F&lt;00||--F-OO--;</code>”</p>
<p>语句“<code>-F&lt;00||--F-OO--;</code>”根据优先级判断，先执行<code>||</code>左边的部分，由于F=0，所以左部分为假（0&lt;0为假），在执行右半部分，先对F自减1，执行<code>F-OO</code>，再对OO自减1。最后的结果为-1，再进行<code>||</code>，舍弃最后结果。折腾半天，只有对F和OO的自减使变量发生了变化，最终的运算结果并不care。</p>
<p>语句“<code>--F&lt;00||--F-OO--;</code>”根据优先级判断，先执行<code>||</code>左边部分，对F自减1后判断是否F&lt;0。经过上个语句后，F值为-1，因此F&lt;0为真，不再执行右半部分。</p>
<p>但是注意！*在单步跟踪“<code>-_</code>”语句时，变量的值没有发生任何变化！*也就是说刚才的分析并不是实际情况。由于变量值没有任何改变，可以肯定<code>||</code>右边的部分根本没有被运行，也就是说<code>||</code>左边的部分结果为真。如果左边的语句解释为“<code>- -F&lt;00</code>”（注意两个减号中间的空格），则F的值没有被改变，且其值为真。因此，这里的“<code>-_</code>”语句实际是被解释成“<code>- -F&lt;00||--F-OO--;</code>”，也就是“<code>(-(-F))&lt;00||--F-OO--;</code>”。</p>
<p>由于“<code>-_</code>”没有对变量的值进行任何操作，因此函数<code>F_00()</code>里看似唬人的大球，实际每行只有行首的“<code>_</code>”语句起作用，是对两个变量的值自减1。因此，整个高度为16的球，实际对两个变量进行16次自减1。真是无聊！！！！！</p>
<p>主程序就简单多了。首先运行<code>F_00()</code>改变两个变量的值，最后运行<code>printf(&quot;%1.3f\n&quot;,4.*-F/OO/OO)</code>语句输出。这个printf语句就简单了，输出一个长度为1，3位小数宽度的浮点数并换行。因为浮点的总长度肯定大于1，所以相当于输出一个3位小数宽的浮点并换行。输出的浮点内容为“<code>4.*-F/OO/OO</code>”，也就是“<code>(4.)*(-F)/OO/OO</code>”，此时F和OO的值都是“-16”，结果很显然，没啥大意思了。</p>
<p>前面所讲到的问题，应该涉及到c语言编译器实现的细节问题。c语言编译器指对宏进行简单替换，而不进行任何语法判断，因此可以肯定，对宏的替换工作是先于语法判断和编译过程的。c编译器在进行语法判断时，使用的是大嘴原则，也就是尽可能将更多的字符解释为运算符等关键字，而实际中并没有将“<code>-_</code>”解释为“<code>--F&lt;00||--F-OO--;</code>”，可以认为，编译器在替换前，会对宏的前后进行标识，将宏本身与前后的语句分开，这样，宏本身的运算符就不会与程序前后的运算符关联在一起，改变宏语句本身的运算符的意义。因此，这个程序中的宏最终解释为“<code>- -F&lt;00||--F-OO--;</code>”。</p>
<p>另一个值得注意的问题是，“<code>-_</code>”在解释为“<code>- -F&lt;00||--F-OO--;</code>”之后，实际宏本身的运算顺序已经改变。这里也是为什么在《c陷阱与缺陷》里，作者特别提到，宏的定义应该加括号，格式为“#define NN (&hellip;)”，以免程序中出现很隐蔽的，改变宏本身运算顺序的逻辑错误。</p>
<p>为了验证编译器对宏的替换过程，编写了下面的程序：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#define A ++a
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>){
 <span style="color:#66d9ef">int</span> a<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;
 a<span style="color:#f92672">=</span>a<span style="color:#f92672">+++</span>A;
}
</code></pre></div><p>实际程序运行通过，证明“<code>a=a+++A</code>”被解释为“<code>a=a+++ ++a</code>”即“<code>a=(a++)+(++a)</code>”，而不是“<code>a=a+++++a</code>”。其中后一种译法会因为大嘴原则译为“<code>a=((a++) ++)+a</code>”第二层的“<code>++</code>”会因为左边不是一个有效变量，而引起编译错误：<code>error C2105: '++' needs l-value</code>。</p>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>:</span>
                <span>Googol Lee </span>
                </p>
            
           
            <p class="copyright-item">
                    <span>:</span>
                   <span>87</span>
            </p>

            <p class="copyright-item">
                
                <span>:</span>
                <span>

      
        <a href="//twitter.com/share?url=https%3a%2f%2fair.googol.im%2fpost%2fanalysis-of-occ-circle%2f&amp;text=%e4%b8%80%e6%ae%b5%e6%9c%89%e8%b6%a3%e7%9a%84C%e7%a8%8b%e5%ba%8f%ef%bc%88%e7%bb%ad%ef%bc%89&amp;via=googollee" target="_blank" title="Share on Twitter">
          <i class="iconfont icon-twitter"></i>
        </a>
        
      
      
      
      
      
      
      
      
        
      
        
      

          

          

          

          

</span>
                
            </p>

             
            <p class="copyright-item">
                Released under <a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a>
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-icon-tag"></i>: 
            
            <span class="tag"><a href="https://air.googol.im/tags/c/">
                    #c</a></span>
            
            <span class="tag"><a href="https://air.googol.im/tags/occ/">
                    #occ</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();"></a></span> · 
                <span><a href="https://air.googol.im"></a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://air.googol.im/post/analysis-of-occ-knocker/" class="prev" rel="prev" title="一段有趣的C程序"><i class="iconfont icon-dajiantou"></i>&nbsp;一段有趣的C程序</a>
         
        
        <a href="https://air.googol.im/post/analysis-of-source-code-printf/" class="next" rel="next" title="内核printf源代码分析">内核printf源代码分析&nbsp;<i class="iconfont icon-xiaojiantou"></i></a>
        
    </div>

    <div class="post-comment">
          
          <div id="disqus_thread"></div>
  <script type="text/javascript">
      (function() {
          
          
          if (window.location.hostname == "localhost")
              return;
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          var disqus_shortname = 'air-g';
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

 

          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2004 - 2021</span>
        
         
            <span class="author" itemprop="copyrightHolder"><a href="https://air.googol.im">Googol Lee</a> | </span>
         

		  <span>Crafted with ❤️ by <a href="https://github.com/Fastbyte01/KeepIt" target="_blank" rel="external nofollow noopener noreffer">KeepIt</a> & <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a></span>
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  







     </div>
  </body>
</html>
