<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    


    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="我为什么喜欢Go"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@googollee"/>



  	<meta property="og:title" content="我为什么喜欢Go &middot; Air on G" />
  	<meta property="og:site_name" content="Air on G" />
  	<meta property="og:url" content="http://air.googol.im/post/why-i-like-go/" />
    
    
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="og:image" content="http://air.googol.im/" />
    <meta property="article:published_time" content="2012-07-09T20:00:00&#43;08:00" />

    
    <meta property="article:tag" content="golang" />
    
    

    <title>我为什么喜欢Go &middot; Air on G</title>

    
    <meta name="description" content="" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://air.googol.im/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://air.googol.im/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="http://air.googol.im/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://air.googol.im/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />

    

    
      
          <link href="http://air.googol.im/index.xml" rel="alternate" type="application/rss+xml" title="Air on G" />
      
      
    
    <meta name="generator" content="Hugo 0.18.1" />

    <link rel="canonical" href="http://air.googol.im/post/why-i-like-go/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": ""
    },
    "author": {
        "@type": "Person",
        "name": "",
        
        "url": "http://air.googol.im",
        "sameAs": [
            
            
             
             
             
             
             
            
        ],
        "description": "my bio"
        
    },
    "headline": "我为什么喜欢Go",
    "name": "我为什么喜欢Go",
    "wordCount":  138 ,
    "timeRequired": "PT1M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "http://air.googol.im/post/why-i-like-go/",
    "datePublished": "2012-07-09T20:00Z",
    "dateModified": "2012-07-09T20:00Z",
    
    "keywords": "golang",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://air.googol.im/post/why-i-like-go/"
    }
}
    </script>
    


    

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Blog</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/googollee">Github repos</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/googollee">Twitter timeline</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="http://air.googol.im/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">我为什么喜欢Go</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2012-07-09T20:00:00&#43;08:00">
            Jul 9, 2012
          </time>
        
         
          <span class="post-tag small"><a href="http://air.googol.im/tags/golang/">#golang</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <p>这半年来工作上一直在用Go，总共统计下来也写了1w多行代码，算上删删改改的，大概能有1w5吧。而且还写了不少go的库，比如android push库<a href="https://github.com/googollee/go_c2dm">go_c2dm</a>，一个简单的IMAP客户端<a href="https://github.com/googollee/goimap">goimap</a>，想继续完善的编码库<a href="https://github.com/googollee/go-encoding-ex">go-encoding-ex</a>。似乎赶着最近Google IO，国外很时兴写对Go的总结，于是我也赶热闹写一篇blog。</p>

<p></p>

<h2 id="我喜欢的go特性">我喜欢的Go特性</h2>

<h3 id="interface">interface</h3>

<p>Go的interface实在是让人眼前一亮的特性，在静态编译语言里引入了动态语言常用的duck type特性，而且还没有任何运行时负担。举个栗子，如果我想给一个struct A实现io.Reader接口，在定义struct A的时，不需要和io.Reader扯上任何关系（不需要继承，不需要包含，什么都不需要），只要对struct A定义Read([]byte) (int, error)这个函数（与对象方法类似）就可以。至于如何把struct A的实例捏成一个io.Reader，全是Go编译器在背后的工作。我斗胆猜一下Go在使用io.Reader这个interface的时候，使用了类似下面的结构：</p>

<pre><code class="language-go">type InterfaceReader struct {
	instancePtr pointer_to_original_instance
	readFunc pointer_to_read_function
}
</code></pre>

<p>而将一个实现了Read成员函数的实例变成io.Reader的时候，执行了类似下面的代码：</p>

<pre><code class="language-go">// Pseudo code for:
//   var i io.Reader
//   i = New(A)
i = New(InterfaceReader)
i.instancePtr = New(A)
i.readFunc = i.instancePtr.Read
</code></pre>

<p>这个伪代码的操作，在编译期就可以完成，不需要在运行时依旧保留很多类型的相关信息。</p>

<h3 id="reflect">reflect</h3>

<p>不过Go依旧在运行时保留了不少的类型信息，用来完成反射。不过Go的反射与Java和其他动态语言比起来，还是有限制：所有的反射操作都必须通过一个实例完成，而不能直接操作类型。比如，可以根据一个实例拿到一个类型并生成这个类型对应的新实例：</p>

<pre><code class="language-go">t := reflect.TypeOf(a)
v := reflect.New(t.Elem())
newA = v.Interface().(*A)
</code></pre>

<p>但是没法直接根据类型的名字拿到类型并生成实例，考虑到这门语言设计目的是效率优先的静态编译语言，这也似乎不是太大的问题，而且可以通过别的方法实现。</p>

<p>不过，目前Go的reflect库不能通过reflect.Type来创建一个Array或者Slice，似乎是个挺杯具且无解的事情，限制很大。</p>

<p>值得一体的是，Go的struct的成员可以定义Tag这种描述信息，程序里没有直接的作用，但可以通过reflect访问到：</p>

<pre><code class="language-go">type A struct {
	i int `tag:&quot;abc&quot;`
}

v := reflect.TypeOf(new(A))
f, _ := v.FieldByName(&quot;i&quot;)
f.Tag.Get(&quot;tag&quot;) == &quot;abc&quot;
</code></pre>

<p>虽然目前Go的标准库里只用Tag来做json编码/解码时对应域的名字，不过似乎可以有更有趣的用法。</p>

<h3 id="channel">channel</h3>

<p>在Go之前，就有不少语言以支持轻量进程的并发为特点，比如广为人知的Erlang（其语法的诡异导致没有大规模流行）。不过Go比Erlang更多了一种叫做channel的类型，用于在进程间传递消息。Erlang里，如果要和一个进程通信，只能给这个进程的pid发消息，消息里带有一个标号。这个进程收到消息后，根据标号再做不同的处理。这种做法使得Erlang里大量出现通信时根据标号做模式匹配的语句，可以类比C的大块大块switch/case，配合Erlang的另一大特点“代码热更新”，经常会写出十分难读的代码。另一方面由于pid要先创建进程后才能拿到，如果想让两个进程互相通信，就必须先创建进程A拿到pid_a，再创建进程B，把pid_a传给进程B，再把进程B的pid_b传给进程A，A拿到pid_b后会对自己的执行体做更新，去实现真正的功能。这个说起来似乎简单，真写一写的话实在头疼。</p>

<p>Go在Erlang的基础上进一步抽象出了channel，使得进程间通信变的更加清晰。一个goroutine可以持有一个或者多个channel。可以先创建channel，把创建好的channel传给若干个需要互相通信的goroutine。这样就完美的解决了Erlang里遇到的两个很拧巴的问题。</p>

<h3 id="goroutine">goroutine</h3>

<p>一句话：并发变得如此简单。</p>

<h3 id="one-executable-binary">one executable binary</h3>

<p>目前Go在编译好后只会有一个bin文件，而且不使用cgo引用c库的话，也不会依赖特殊的库。在生产环境部署Go真是痛快无比，再也不用想是不是要升级这个gem，是不是要下那个egg，是不是这个版本滞后了，是不是那个api不兼容……</p>

<h3 id="go-fmt">go fmt</h3>

<p>配合<a href="http://www.sublimetext.com/2">Sublime2</a> + <a href="https://github.com/DisposaBoy/GoSublime">GoSublime</a>，再也不用费心代码格式的问题了。</p>

<h2 id="使用中遇到的问题">使用中遇到的问题</h2>

<h3 id="用成员首字母的大小写来控制可见性">用成员首字母的大小写来控制可见性</h3>

<p><del>这真是很诡异的特性：</del>所有名字首字母大写的成员，是对包外可见的；所有名字首字母小写的成员，都是包外不可见的。</p>

<p><del>这一条就使得Go命名与下划线分割的命名方式绝缘，只能选用驼峰命名法。因为PublicName和privateName看上去还算协调，如果出现Public_name，就怎么看怎么诡异了。或许以后可以用驼峰作为公开命名PublicName，而用下划线作为私有命名private_name。</del></p>

<p>更新：经过一段时间的使用，Go选择这种命名方式真是太好了。在看一段代码时，只要看到首字母大写的，就能知道这个变量/函数是公开的，不能轻易修改；而对于小写的变量/函数修改就像对自由很多。维护的时候再也不用去来回翻阅声明，检查一个变量/函数是不是可以变了！</p>

<p>不过Go官方推荐都用驼峰命名。</p>

<p>多说一句，在做json解码时，如果对应的struct没有特殊声明，会把json的域写入对应名字首字母大写的struct的成员里。而json编码时默认会以struct域的名字作为json域名，如果要对应到小写，需要声明相关域的Tag：</p>

<pre><code class="language-go">type A struct {
	I int `json:&quot;i&quot;`
}
</code></pre>

<h3 id="reflect还有问题">reflect还有问题</h3>

<p>前面也提过，不能根据reflect.Type直接生成对应的Slice或者Array或者Map实在太讨厌了！</p>

<h2 id="期望">期望</h2>

<p>Go还是一门很年轻的语言，如果要对其提出展望的话，我期望以下特性：</p>

<h3 id="reflect支持创建对应type的slice和array">reflect支持创建对应Type的Slice和Array</h3>

<p>前面多次提到了。</p>

<h3 id="struct的成员函数也能支持tag">struct的成员函数也能支持tag</h3>

<p>目前tag只能支持成员变量，如果也能给成员函数写tag就太cool了：</p>

<pre><code class="language-go">type A struct {}

func (a *A) `tag:&quot;id&quot;` SomeFunc() {}
</code></pre>

<h3 id="完善库">完善库</h3>

<p>没有IMAP好痛苦！自己实现IMAP好蛋疼！ <em>(:з」∠)</em></p>

<p>目前我可能比较急需的库：多语言本地化（大概把ICU直接port过来），更多的编解码，能换个更好用的text模版库么（模版里写个range都没法判断是不是到了最后一个元素，想用模版输出“a, b, c and d.”简直要死人啊）。</p>

<h3 id="heroku">heroku</h3>

<p>严格来说这个不是对Go语言的期望。现在GAE已经支持Go了，但是因为GAE的api太特殊，为GAE写的程序只能跑在GAE，不能自己部署，所以稍微有点不爽。如果heroku可以支持Go的话，就可以做到本地云间一个样了。可惜看上去heroku目前并<a href="https://twitter.com/heroku/status/221990016329596928">没有支持Go的打算</a>。</p>

<p>（不过heroku内部已经把一部分ruby模块切换到Go了，或许可以期待一下？）</p>

<h2 id="后记">后记</h2>

<p>Go的前途是光明的！道路是曲折的！以后我也会在blog里多分享一些自己使用Go遇到的问题和惯用法。</p>
    </section>


  <footer class="post-footer">


    

    





<section class="author">
  <h4><a href="http://air.googol.im/">Googol Lee</a></h4>
  
  <p>my bio</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Munich, Germany</span>
    <span class="author-link icon-link"><a href="http://air.googol.im">http://air.googol.im</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=%e6%88%91%e4%b8%ba%e4%bb%80%e4%b9%88%e5%96%9c%e6%ac%a2Go&nbsp;-&nbsp;Air%20on%20G&amp;url=http%3a%2f%2fair.googol.im%2fpost%2fwhy-i-like-go%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fair.googol.im%2fpost%2fwhy-i-like-go%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2fair.googol.im%2fpost%2fwhy-i-like-go%2f&amp;description=%e6%88%91%e4%b8%ba%e4%bb%80%e4%b9%88%e5%96%9c%e6%ac%a2Go"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fair.googol.im%2fpost%2fwhy-i-like-go%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'air-g';
  var disqus_url = 'http:\/\/air.googol.im\/post\/why-i-like-go\/';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Air on G</a> All rights reserved - 2017</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://air.googol.im/js/jquery.js"></script>
    <script type="text/javascript" src="http://air.googol.im/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://air.googol.im/js/index.js"></script>
    
</body>
</html>

