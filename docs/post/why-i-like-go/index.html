<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  
  <link rel="prev" href="https://air.googol.im/post/gotour-exercise-web-crawl/" />
  <link rel="next" href="https://air.googol.im/post/wired-golang/" />
  <link rel="canonical" href="https://air.googol.im/post/why-i-like-go/" />
  <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           我为什么喜欢Go | Air on G
       
  </title>
  <meta name="title" content="我为什么喜欢Go | Air on G">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="我为什么喜欢Go"/>
<meta name="twitter:description" content="这半年来工作上一直在用Go，总共统计下来也写了1w多行代码，算上删删改改的，大概能有1w5吧。而且还写了不少go的库，比如android push库go_c2dm，一个简单的IMAP客户端goimap，想继续完善的编码库go-encoding-ex。似乎赶着最近Google IO，国外很时兴写对Go的总结，于是我也赶热闹写一篇blog。"/>

  <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "我为什么喜欢Go",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/air.googol.im\/post\/why-i-like-go\/"
  },
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/air.googol.im\/cover.png",
    "width":  800 ,
    "height":  600 
  },
  "genre": "post",
  "keywords": "golang",
  "wordcount":  2727 ,
  "url": "https:\/\/air.googol.im\/post\/why-i-like-go\/",
  "datePublished": "2012-07-09T20:00:00\u002b08:00",
  "dateModified": "2012-07-09T20:00:00\u002b08:00",
  "license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.",
  "publisher": {
    "@type": "Organization",
    "name": "Googol Lee",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/air.googol.im\/logo.png",
      "width":  127 ,
      "height":  40 
    }
  },
  "author": {
    "@type": "Person",
    "name": "Googol Lee"
  },
  "description": ""
}
</script>
</head>

  



  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="https://air.googol.im">Air on G</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/post/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
                <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;<a href="https://air.googol.im">Air on G</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/post/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
        </div>
    </div>
</nav>

    	 <main class="main">
          <div class="container">
      		
<article class="post-warp">
    <header class="post-header">
        <h1 class="post-title">我为什么喜欢Go</h1>
        <div class="post-meta">
              <a href="https://air.googol.im" rel="author">Googol Lee</a>  ♥ 
                <span class="post-time">
                     <time datetime=2012-07-09 >2012-07-09</time>
                </span>
                
                
                <i class="iconfont icon-timer"></i>
                6 min
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <p>这半年来工作上一直在用Go，总共统计下来也写了1w多行代码，算上删删改改的，大概能有1w5吧。而且还写了不少go的库，比如android push库<a href="https://github.com/googollee/go_c2dm">go_c2dm</a>，一个简单的IMAP客户端<a href="https://github.com/googollee/goimap">goimap</a>，想继续完善的编码库<a href="https://github.com/googollee/go-encoding-ex">go-encoding-ex</a>。似乎赶着最近Google IO，国外很时兴写对Go的总结，于是我也赶热闹写一篇blog。</p>
<h2 id="我喜欢的go特性">我喜欢的Go特性</h2>
<h3 id="interface">interface</h3>
<p>Go的interface实在是让人眼前一亮的特性，在静态编译语言里引入了动态语言常用的duck type特性，而且还没有任何运行时负担。举个栗子，如果我想给一个struct A实现io.Reader接口，在定义struct A的时，不需要和io.Reader扯上任何关系（不需要继承，不需要包含，什么都不需要），只要对struct A定义Read([]byte) (int, error)这个函数（与对象方法类似）就可以。至于如何把struct A的实例捏成一个io.Reader，全是Go编译器在背后的工作。我斗胆猜一下Go在使用io.Reader这个interface的时候，使用了类似下面的结构：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">InterfaceReader</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">instancePtr</span> <span style="color:#a6e22e">pointer_to_original_instance</span>
	<span style="color:#a6e22e">readFunc</span> <span style="color:#a6e22e">pointer_to_read_function</span>
}
</code></pre></div><p>而将一个实现了Read成员函数的实例变成io.Reader的时候，执行了类似下面的代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Pseudo code for:
</span><span style="color:#75715e">//   var i io.Reader
</span><span style="color:#75715e">//   i = New(A)
</span><span style="color:#75715e"></span><span style="color:#a6e22e">i</span> = <span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">InterfaceReader</span>)
<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">instancePtr</span> = <span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">A</span>)
<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">readFunc</span> = <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">instancePtr</span>.<span style="color:#a6e22e">Read</span>
</code></pre></div><p>这个伪代码的操作，在编译期就可以完成，不需要在运行时依旧保留很多类型的相关信息。</p>
<h3 id="reflect">reflect</h3>
<p>不过Go依旧在运行时保留了不少的类型信息，用来完成反射。不过Go的反射与Java和其他动态语言比起来，还是有限制：所有的反射操作都必须通过一个实例完成，而不能直接操作类型。比如，可以根据一个实例拿到一个类型并生成这个类型对应的新实例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">a</span>)
<span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Elem</span>())
<span style="color:#a6e22e">newA</span> = <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Interface</span>().(<span style="color:#f92672">*</span><span style="color:#a6e22e">A</span>)
</code></pre></div><p>但是没法直接根据类型的名字拿到类型并生成实例，考虑到这门语言设计目的是效率优先的静态编译语言，这也似乎不是太大的问题，而且可以通过别的方法实现。</p>
<p>不过，目前Go的reflect库不能通过reflect.Type来创建一个Array或者Slice，似乎是个挺杯具且无解的事情，限制很大。</p>
<p>值得一体的是，Go的struct的成员可以定义Tag这种描述信息，程序里没有直接的作用，但可以通过reflect访问到：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">A</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span> <span style="color:#e6db74">`tag:&#34;abc&#34;`</span>
}

<span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(new(<span style="color:#a6e22e">A</span>))
<span style="color:#a6e22e">f</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">FieldByName</span>(<span style="color:#e6db74">&#34;i&#34;</span>)
<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">Tag</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;tag&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;abc&#34;</span>
</code></pre></div><p>虽然目前Go的标准库里只用Tag来做json编码/解码时对应域的名字，不过似乎可以有更有趣的用法。</p>
<h3 id="channel">channel</h3>
<p>在Go之前，就有不少语言以支持轻量进程的并发为特点，比如广为人知的Erlang（其语法的诡异导致没有大规模流行）。不过Go比Erlang更多了一种叫做channel的类型，用于在进程间传递消息。Erlang里，如果要和一个进程通信，只能给这个进程的pid发消息，消息里带有一个标号。这个进程收到消息后，根据标号再做不同的处理。这种做法使得Erlang里大量出现通信时根据标号做模式匹配的语句，可以类比C的大块大块switch/case，配合Erlang的另一大特点“代码热更新”，经常会写出十分难读的代码。另一方面由于pid要先创建进程后才能拿到，如果想让两个进程互相通信，就必须先创建进程A拿到pid_a，再创建进程B，把pid_a传给进程B，再把进程B的pid_b传给进程A，A拿到pid_b后会对自己的执行体做更新，去实现真正的功能。这个说起来似乎简单，真写一写的话实在头疼。</p>
<p>Go在Erlang的基础上进一步抽象出了channel，使得进程间通信变的更加清晰。一个goroutine可以持有一个或者多个channel。可以先创建channel，把创建好的channel传给若干个需要互相通信的goroutine。这样就完美的解决了Erlang里遇到的两个很拧巴的问题。</p>
<h3 id="goroutine">goroutine</h3>
<p>一句话：并发变得如此简单。</p>
<h3 id="one-executable-binary">one executable binary</h3>
<p>目前Go在编译好后只会有一个bin文件，而且不使用cgo引用c库的话，也不会依赖特殊的库。在生产环境部署Go真是痛快无比，再也不用想是不是要升级这个gem，是不是要下那个egg，是不是这个版本滞后了，是不是那个api不兼容……</p>
<h3 id="go-fmt">go fmt</h3>
<p>配合<a href="http://www.sublimetext.com/2">Sublime2</a> + <a href="https://github.com/DisposaBoy/GoSublime">GoSublime</a>，再也不用费心代码格式的问题了。</p>
<h2 id="使用中遇到的问题">使用中遇到的问题</h2>
<h3 id="用成员首字母的大小写来控制可见性">用成员首字母的大小写来控制可见性</h3>
<p><!-- raw HTML omitted -->这真是很诡异的特性：<!-- raw HTML omitted -->所有名字首字母大写的成员，是对包外可见的；所有名字首字母小写的成员，都是包外不可见的。</p>
<p><!-- raw HTML omitted -->这一条就使得Go命名与下划线分割的命名方式绝缘，只能选用驼峰命名法。因为PublicName和privateName看上去还算协调，如果出现Public_name，就怎么看怎么诡异了。或许以后可以用驼峰作为公开命名PublicName，而用下划线作为私有命名private_name。<!-- raw HTML omitted --></p>
<p>更新：经过一段时间的使用，Go选择这种命名方式真是太好了。在看一段代码时，只要看到首字母大写的，就能知道这个变量/函数是公开的，不能轻易修改；而对于小写的变量/函数修改就像对自由很多。维护的时候再也不用去来回翻阅声明，检查一个变量/函数是不是可以变了！</p>
<p>不过Go官方推荐都用驼峰命名。</p>
<p>多说一句，在做json解码时，如果对应的struct没有特殊声明，会把json的域写入对应名字首字母大写的struct的成员里。而json编码时默认会以struct域的名字作为json域名，如果要对应到小写，需要声明相关域的Tag：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">A</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">I</span> <span style="color:#66d9ef">int</span> <span style="color:#e6db74">`json:&#34;i&#34;`</span>
}
</code></pre></div><h3 id="reflect还有问题">reflect还有问题</h3>
<p>前面也提过，不能根据reflect.Type直接生成对应的Slice或者Array或者Map实在太讨厌了！</p>
<h2 id="期望">期望</h2>
<p>Go还是一门很年轻的语言，如果要对其提出展望的话，我期望以下特性：</p>
<h3 id="reflect支持创建对应type的slice和array">reflect支持创建对应Type的Slice和Array</h3>
<p>前面多次提到了。</p>
<h3 id="struct的成员函数也能支持tag">struct的成员函数也能支持tag</h3>
<p>目前tag只能支持成员变量，如果也能给成员函数写tag就太cool了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">A</span> <span style="color:#66d9ef">struct</span> {}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">A</span>) <span style="color:#e6db74">`tag:&#34;id&#34;`</span> <span style="color:#a6e22e">SomeFunc</span>() {}
</code></pre></div><h3 id="完善库">完善库</h3>
<p>没有IMAP好痛苦！自己实现IMAP好蛋疼！ <em>(:з」∠)</em></p>
<p>目前我可能比较急需的库：多语言本地化（大概把ICU直接port过来），更多的编解码，能换个更好用的text模版库么（模版里写个range都没法判断是不是到了最后一个元素，想用模版输出“a, b, c and d.”简直要死人啊）。</p>
<h3 id="heroku">heroku</h3>
<p>严格来说这个不是对Go语言的期望。现在GAE已经支持Go了，但是因为GAE的api太特殊，为GAE写的程序只能跑在GAE，不能自己部署，所以稍微有点不爽。如果heroku可以支持Go的话，就可以做到本地云间一个样了。可惜看上去heroku目前并<a href="https://twitter.com/heroku/status/221990016329596928">没有支持Go的打算</a>。</p>
<p>（不过heroku内部已经把一部分ruby模块切换到Go了，或许可以期待一下？）</p>
<h2 id="后记">后记</h2>
<p>Go的前途是光明的！道路是曲折的！以后我也会在blog里多分享一些自己使用Go遇到的问题和惯用法。</p>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>:</span>
                <span>Googol Lee </span>
                </p>
            
           
            <p class="copyright-item">
                    <span>:</span>
                   <span>2727</span>
            </p>

            <p class="copyright-item">
                
                <span>:</span>
                <span>

      
        <a href="//twitter.com/share?url=https%3a%2f%2fair.googol.im%2fpost%2fwhy-i-like-go%2f&amp;text=%e6%88%91%e4%b8%ba%e4%bb%80%e4%b9%88%e5%96%9c%e6%ac%a2Go&amp;via=googollee" target="_blank" title="Share on Twitter">
          <i class="iconfont icon-twitter"></i>
        </a>
        
      
      
      
      
      
      
      
      
        
      
        
      

          

          

          

          

</span>
                
            </p>

             
            <p class="copyright-item">
                Released under <a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a>
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-icon-tag"></i>: 
            
            <span class="tag"><a href="https://air.googol.im/tags/golang/">
                    #golang</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();"></a></span> · 
                <span><a href="https://air.googol.im"></a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://air.googol.im/post/gotour-exercise-web-crawl/" class="prev" rel="prev" title="关于gotour最后一题的一些想法"><i class="iconfont icon-dajiantou"></i>&nbsp;关于gotour最后一题的一些想法</a>
         
        
        <a href="https://air.googol.im/post/wired-golang/" class="next" rel="next" title="Go语言奇怪的特性">Go语言奇怪的特性&nbsp;<i class="iconfont icon-xiaojiantou"></i></a>
        
    </div>

    <div class="post-comment">
          
          <div id="disqus_thread"></div>
  <script type="text/javascript">
      (function() {
          
          
          if (window.location.hostname == "localhost")
              return;
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          var disqus_shortname = 'air-g';
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

 

          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2004 - 2021</span>
        
         
            <span class="author" itemprop="copyrightHolder"><a href="https://air.googol.im">Googol Lee</a> | </span>
         

		  <span>Crafted with ❤️ by <a href="https://github.com/Fastbyte01/KeepIt" target="_blank" rel="external nofollow noopener noreffer">KeepIt</a> & <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a></span>
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  







     </div>
  </body>
</html>
